openapi: 3.0.3
info:
  title: Photo Contest API
  version: 1.0.0

servers:
  - url: http://localhost:8000/api

tags:
  - name: Contests
    description: Операции с конкурсами
  - name: Entries
    description: Работы конкурса
  - name: Ratings
    description: Оценка работ

paths:
  /contests/{contestId}:
    get:
      tags:
        - Contests
      summary: Получить информацию о конкурсе
      description: Поле criteria доступно только членам жюри
      parameters:
        - name: contestId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Информация о конкурсе
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contest"
        "404":
          description: Конкурс не найден
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /contests/{contestId}/entries:
    get:
      tags:
        - Entries
      summary: Получить работы для оценки
      parameters:
        - name: contestId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Список работ
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Entry"
        "404":
          description: Конкурс не найден
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    post:
      tags:
        - Entries
      summary: Отправить работу на конкурс
      parameters:
        - name: contestId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntryRequest"
      responses:
        "200":
          description: Работа успешно отправлена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntryResponse"
        "400":
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Конкурс не найден
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /contests/{contestId}/entries/rate:
    post:
      tags:
        - Entries
      summary: Оценить работу
      parameters:
        - name: contestId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RatingRequest"
      responses:
        "200":
          description: Оценка сохранена
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RatingResponse"
        "400":
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Конкурс или работа не найдены
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /contests/{contestId}/ratings/history:
    get:
      tags:
        - Ratings
      summary: Получить историю оценок
      parameters:
        - name: contestId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: История оценок
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RatingHistoryItem"
        "404":
          description: Конкурс не найден
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Contest:
      type: object
      required:
        - id
        - name
        - nominations
        - criteria
      properties:
        id:
          type: string
        name:
          type: string
        nominations:
          type: array
          items:
            type: string
        criteria:
          type: array
          items:
            $ref: "#/components/schemas/Criterion"

    EntryRequest:
      type: object
      required:
        - fullName
        - email
        - workTitle
        - nomination
        - photo
      properties:
        fullName:
          type: string
        email:
          type: string
          format: email
        workTitle:
          type: string
        nomination:
          type: string
        photo:
          type: string
          format: byte

    EntryResponse:
      type: object
      required:
        - success
        - entryId
      properties:
        success:
          type: boolean
        entryId:
          type: string

    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string

    Entry:
      type: object
      required:
        - id
        - url
        - title
      properties:
        id:
          type: string
        url:
          type: string
        title:
          type: string

    Criterion:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
        name:
          type: string

    RatingRequest:
      type: object
      required:
        - entryId
        - ratings
      properties:
        entryId:
          type: string
        ratings:
          type: array
          items:
            $ref: "#/components/schemas/Rating"

    RatingResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean

    RatingHistoryItem:
      type: object
      required:
        - entry
        - ratings
      properties:
        entry:
          $ref: "#/components/schemas/Entry"
        ratings:
          type: array
          items:
            $ref: "#/components/schemas/Rating"

    Rating:
      type: object
      required:
        - criterionId
        - value
      properties:
        criterionId:
          type: string
        value:
          type: integer
          minimum: 1
          maximum: 10

